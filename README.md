# Zaimanhua Auto Check-in

基于青龙面板的再漫画 (zaimanhua.com) 每日任务自动化工具。

## 功能特性

| 功能 | 说明 | 触发时间 (北京) |
|-----|------|----------------|
| 每日签到 | 自动完成签到任务、领取积分、领取VIP福利 | 8:00 |
| 每日评论 | 在随机漫画下发表评论 | 9:30 |
| 每日阅读 | 自动阅读漫画 | 10:00 |
| 每日抽奖 | 完成任务并自动抽奖 | 11:00 |
| 四周年活动 | 发送祝福 + 转盘抽奖 | 5:00-23:00 每20分钟 |
| 新年活动 | 完成任务 + 祝福抽奖 | 8:00-23:00 每15分钟 |
| 积分领取 | 任务完成后自动领取积分 | 随任务执行 |

其他特性：
- 支持多账号
- 日志显示账号真实用户名，便于识别
- Cookie 失效自动检测并给出更新提示
- 所有任务支持手动触发
- 智能跳过无效/付费章节
- 避免重复评论同一漫画

### 抽奖功能说明

抽奖活动入口：https://luck-draw.zaimanhua.com/

> **注意事项：**
> - 该页面需要在**手机端**或**移动端浏览器**访问
> - **首次使用**需要手动关注官方微博，之后脚本可自动完成任务
> - 抽奖任务包括：关注微博、分享页面、阅读漫画

### 四周年活动说明

活动入口：https://activity.zaimanhua.com/draw-4th/

> **活动时间：** 2026.1.16 - 2026.1.22
>
> **功能说明：**
> - **发送祝福**：自动在弹幕墙发送祝福语
> - **转盘抽奖**：自动使用所有可用抽奖次数
>
> **触发频率：** 北京时间 5:00-23:00，每 20 分钟触发一次
>
> **注意：** 活动结束后可在青龙中禁用或删除对应任务

### 新年活动说明

活动入口：https://activity.zaimanhua.com/newYear/

> **活动时间：** 2026.2.15 - 2026.2.23，每天 10:00-24:00
>
> **功能说明：**
> - **分享任务**：自动完成分享获取抽奖机会
> - **观看漫画**：通过 Playwright 访问漫画页面完成任务
> - **祝福评论**：每次执行发送一条随机祝福弹幕，获取抽奖机会
> - **自动抽奖**：用完所有可用抽奖次数
>
> **触发频率：** 北京时间 8:00-23:00，每 15 分钟触发一次
>
> **注意：** 活动结束后可在青龙中禁用或删除对应任务

### 每日评论功能说明

> **重要：账号需要绑定手机号才能正常发表评论**
>
> 未绑定手机号的账号可以"发送"评论（前端不阻止），但评论不会真正发布到评论区，任务也不会完成。
> 如果发现评论任务一直失败，请检查账号是否已绑定手机号。

## 快速开始（青龙）

### 1. 获取 Cookie

1. 在浏览器中登录 https://i.zaimanhua.com/
2. 按 **F12** 打开开发者工具
3. 切换到 **Console（控制台）** 标签
4. 输入以下命令并回车：
   ```javascript
   document.cookie
   ```
5. 复制输出的整个字符串（去掉首尾引号）

### 2. 配置青龙环境变量

1. 打开青龙面板
2. 进入 **环境变量**
3. 新建变量：`ZAIMANHUA_COOKIE`
4. 值填写上一步复制的 Cookie（多账号时按回车分隔，每行一个）

示例：

```bash
# 单账号
ZAIMANHUA_COOKIE='your_cookie_here'

# 多账号（回车分隔）
ZAIMANHUA_COOKIE='cookie_account_1
cookie_account_2'
```

### 3. 安装依赖

```bash
pip3 install -r requirements.txt
```

首次执行任务时，脚本会自动调用 `scripts/ensure_playwright.sh` 安装 Playwright Chromium。  
如需手动提前初始化，可执行：

```bash
sh scripts/ensure_playwright.sh
```

如果日志出现以下错误（例如：`error while loading shared libraries: libnspr4.so`），说明系统缺少 Playwright 运行库，可在青龙容器内执行：

```bash
python3 -m playwright install --with-deps chromium
```

如果环境没有 `python3`，可将命令中的 `python3` 替换为 `python`。

### 4. 配置订阅并开启自动添加任务

1. 在青龙中添加本仓库订阅
2. 开启 **自动添加任务（autoAddCron）**
3. 拉库后自动生成任务

### 5. 手动测试

1. 进入青龙 **定时任务**
2. 先手动执行 `再漫画_每日签到`
3. 查看任务日志确认运行成功

## 青龙面板拉库（自动添加任务）

本仓库的任务脚本已添加青龙可识别的任务头（`cron:` + `new Env(...)`）。  
在订阅配置中开启 **自动添加任务（autoAddCron）** 后，拉库会自动创建对应定时任务。

### 1. 配置环境变量

在青龙 `环境变量` 中添加：

| 变量名 | 说明 |
|------|------|
| `ZAIMANHUA_COOKIE` | Cookie 字符串（多账号时按回车分隔） |

多账号推荐值示例（每行一个 Cookie，代码内自动转为字符串列表）：

```text
cookie_account_1
cookie_account_2
cookie_account_3
```

### 2. 安装依赖

```bash
pip3 install -r requirements.txt
```

### 3. 订阅配置建议

- 订阅地址：你的仓库地址（例如 `https://github.com/<你的用户名>/zaimanhua-qinglong.git`）
- 分支：`main`
- 文件类型/后缀：包含 `py`
- 白名单（可选）：`src/`
- 开启：`自动添加任务（autoAddCron）`

### 4. 自动创建任务清单（默认北京时间）

| 任务名 | Cron | 脚本 |
|------|------|------|
| 再漫画_每日签到 | `0 8 * * *` | `src/checkin.py` |
| 再漫画_每日评论 | `30 9 * * *` | `src/comment.py` |
| 再漫画_每日阅读 | `0 10 * * *` | `src/auto_read.py` |
| 再漫画_每日抽奖 | `0 11 * * *` | `src/lottery.py` |
| 再漫画_四周年活动 | `*/20 5-23 * * *` | `src/draw_4th.py` |
| 再漫画_2026新年活动 | `*/15 8-23 * * *` | `src/2026new_year.py` |

> 活动类任务在活动结束后可直接在青龙中禁用或删除。

## 多账号配置

如需多账号执行任务，只需配置一个环境变量 `ZAIMANHUA_COOKIE`，值按回车分隔（每行一个 Cookie）：

```text
cookie_account_1
cookie_account_2
cookie_account_3
```

> 所有配置的账号会按列表顺序依次执行任务。

## 项目结构

```
├── src/
│   ├── checkin.py      # 签到脚本
│   ├── comment.py      # 评论脚本
│   ├── auto_read.py    # 阅读脚本 (API 模拟)
│   ├── lottery.py      # 抽奖脚本
│   ├── draw_4th.py     # 四周年活动脚本
│   ├── 2026new_year.py # 新年活动脚本
│   └── utils.py        # 共享工具函数
└── requirements.txt    # Python 依赖
```

## 任务时间表

| 任务 | UTC 时间 | 北京时间 |
|----------|---------|---------|
| 签到 | 00:00 | 08:00 |
| 评论 | 01:30 | 09:30 |
| 阅读 | 02:00 | 10:00 |
| 抽奖 | 03:00 | 11:00 |
| 四周年活动 | 21:00-15:00 每20分钟 | 5:00-23:00 每20分钟 |
| 新年活动 | 0:00-15:00 每15分钟 | 8:00-23:00 每15分钟 |

## 注意事项

- **Cookie 有效期**：Cookie 可能会过期，失效时任务会报错，届时请按下方步骤更新
- **执行时长**：阅读任务耗时较长，建议错峰运行或按需调整 cron
- **隐私安全**：Cookie 属于敏感信息，请仅保存在青龙环境变量中

## Cookie 过期更新

当 Cookie 失效时，任务运行日志会显示如下错误：

```
[ERROR] Cookie 无效: API 返回错误: 用户未登录
请更新 默认账号 (张三) 的 Cookie
```

### 1. 重新获取 Cookie

1. 在浏览器中打开 https://i.zaimanhua.com/ 并**重新登录**（或确认已登录）
2. 按 **F12** 打开开发者工具
3. 切换到 **Console（控制台）** 标签
4. 输入以下命令并回车：
   ```javascript
   document.cookie
   ```
5. 复制输出的整个字符串（去掉首尾引号）

### 2. 更新青龙环境变量

1. 打开青龙面板，进入 **环境变量**
2. 找到变量 `ZAIMANHUA_COOKIE`
3. 编辑变量值：
   - 单账号：直接替换为新的 Cookie 字符串
   - 多账号：按行更新对应账号的 Cookie
4. 保存更新

### 3. 验证更新

1. 进入青龙 **定时任务**
2. 手动执行任意再漫画任务
3. 查看运行日志，确认不再出现 Cookie 无效错误

> **提示**：日志中会显示账号的真实用户名（如 `默认账号 (张三)`），方便快速定位需要更新的账号。

## 技术栈

- Python 3.11
- Playwright（浏览器自动化）
- 青龙面板（定时任务）

## 免责声明

**重要提示：请在使用本项目前仔细阅读以下声明**

1. **仅供学习交流**：本项目仅供学习和技术交流使用，不得用于任何商业用途或非法目的。

2. **风险自负**：使用本项目可能违反再漫画网站的服务条款。因使用本项目而导致的任何账号封禁、数据丢失或其他损失，作者概不负责。

3. **遵守法律法规**：用户应遵守当地法律法规及再漫画网站的使用条款。如有违反，后果自负。

4. **不提供担保**：本项目按"原样"提供，不提供任何形式的明示或暗示担保。

5. **Cookie 安全**：请妥善保管您的 Cookie 信息，不要泄露给他人。

6. **随时停止维护**：作者保留随时停止维护本项目的权利，恕不另行通知。

**使用本项目即表示您已阅读、理解并同意以上免责声明。如不同意，请立即停止使用并删除本项目。**

## License

MIT
